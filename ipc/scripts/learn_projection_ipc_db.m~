#!/home/mlshack/alex/Programs/octave-3.8.2/bin/octave -qf

### wrapper octave script to learn the projections. It learns the projection and puts the learned learned w , minproj and maxproj in the exp database

global __DS_VERBOSE = false;

srcdir = "~/Research/mcfilter/src";

#addpath("../scripts/")
addpath([srcdir "/octave/"])
addpath([srcdir "/libsvm-3.17/matlab/"])
addpath([srcdir "/liblinear-1.94/matlab/"])

addpath("~/Research/mcfilter/scripts")
addpath("~/Research/mcfilter/ds_scripts")

#addpath("~/Programs/gperftools-2.1/install/lib/")

data_params.type = "data_file";
data_params.original_train.name = "ipc";
data_params.min_ex_per_class = 0;
data_params.min_word_count = 1;
data_params.coding = "none";
data_params.normalization = "row";

proj_params = default_proj_params();

## override the default params for this dataset
proj_params.exp_name = "ipc_full";
proj_params.C1 = 200000;
proj_params.C2 = 100;
proj_params.max_iter = 1e5;
proj_params.optimizeLU_epoch = proj_params.max_iter;
proj_params.seed = 2131;
proj_params.data_query = struct2query(data_params);

## process command line arguments
arg_list = argv(); 
firstarg = 1;
database = "";
if (!strncmp(arg_list{1},"-", 1))
  database = arg_list{1};
  firstarg = 2;
endif 
arg_list = arg_list(firstarg:end);
proj_params=process_proj_params_args(arg_list, length(arg_list), proj_params);

## it would be nice to do this in the default params, but we would need 
## lazy evaluation for this

## override the defaults with dataset specific 
## need to be careful not to override the parameters already set through 
## command line arguments arguments

time_str = num2str(time());   
   
if (isempty(proj_params.projection_file))
  proj_params.projection_file = sprintf("results/wlu__%s__C1_%g__C2_%g__%s.mat",proj_params.exp_name, proj_params.C1, proj_params.C2,time_str);
  if (!exist("results","dir"))
    mkdir("results");
  endif
endif 
if (isempty(proj_params.obj_plot_file))
  proj_params.obj_plot_file = sprintf("obj_plots/objective_plot__%s__C1_%g__C2__%g__%s.pdf", proj_params.exp_name, proj_params.C1, proj_params.C2, time_str);
  if (!exist("obj_plots","dir"))
    mkdir("obj_plots");
  endif
endif 
if (isempty(proj_params.log_file))
  proj_params.log_file = sprintf("log_files/%s__C1_%g__C2_%g.log",proj_params.exp_name, proj_params.C1, proj_params.C2);
  if (!exist("log_files","dir"))
    mkdir("log_files");
  endif
endif 

## get the default parameters 
## because these depend on other parameters we need to do it after 
## parsing the input arguments and setting the 
## file default params
proj_params = default_proj_param_strings(proj_params);


learn_projection_db(proj_params, database);
